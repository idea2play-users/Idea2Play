<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design Studio â€“ Idea2Play</title>
  <link rel="stylesheet" href="./css/style.css">
  <link rel="stylesheet" href="./css/navbar.css">
</head>
<body class="studio-body">

<header class="studio-header">
  <img src="./assets/logo.png" class="logo" alt="Logo">
  <button id="logoutBtn">Logout</button>
</header>

<main class="studio-layout">
  <aside class="studio-sidebar">
    <input id="title" placeholder="Game title">
    <button id="save">Save Project</button>
  </aside>

  <section class="studio-chat">
    <div id="chat" class="chat-stream">
      <div class="chat-bubble ai">Describe your game idea.</div>
    </div>
    <div class="chat-input">
      <input id="msg" placeholder="Type...">
      <button id="send">Send</button>
    </div>
  </section>
</main>

<script type="module">
  import { db, logoutUser } from "./js/firebase.js";
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  document.getElementById("logoutBtn").onclick = logoutUser;

  async function loadProject() {
    const params = new URLSearchParams(location.search);
    const projectId = params.get("project");
    if (!projectId) return;

    const ref = doc(db, "projects", projectId);
    const snap = await getDoc(ref);

    if (!snap.exists()) return;

    const data = snap.data();
    title.value = data.title;
    chat.innerHTML = "";

    (data.chat || []).forEach(m => {
      chat.innerHTML += `
        <div class="chat-bubble ${m.role}">
          ${m.text}
        </div>
      `;
    });
  }

  loadProject();
</script>

<script src="./js/studio.js"></script>
<script type="module" src="./js/navbar.js"></script>
</body>
</html>
